# ============================================
# ArgoCD Image Updater - ConfigMap
# Configuracoes de registries e comportamento
# ============================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-image-updater-config
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-image-updater
    app.kubernetes.io/part-of: argocd-image-updater
data:
  # Intervalo de verificacao (2 minutos)
  registries.conf: |
    registries:
      # Azure Container Registry (DEV)
      - name: ACR Iris Dev
        api_url: https://acririsdev.azurecr.io
        prefix: acririsdev.azurecr.io
        credentials: pullsecret:argocd/acr-credentials
        default: true

      # Azure Container Registry (PROD) - descomentar quando existir
      # - name: ACR Iris Prod
      #   api_url: https://acririsprod.azurecr.io
      #   prefix: acririsprod.azurecr.io
      #   credentials: pullsecret:argocd/acr-credentials-prod

  # Log level
  log.level: info

  # Estrategia de atualizacao de Git
  git.commit-message-template: |
    build: update image {{ .AppName }} to {{ .NewImage }}

    Image updated automatically by ArgoCD Image Updater

    - Old: {{ .OldImage }}
    - New: {{ .NewImage }}

  # Metodo de escrita no Git (usando ArgoCD credentials)
  applications.api-gateway.write-back-method: git
  applications.inference-service.write-back-method: git
